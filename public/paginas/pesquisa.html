<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,300;1,300&display=swap"
        rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../estilos/pesquisa.css">
    <title>LocalTop</title>
</head>

<body style="background-color: #F7EFE6; display: flex; flex-direction: column;">
    <header>
        <a href="/" class="logoLink">
            <img src="../imagens/logo/SVG Variações/Branco/Horizontal-Branco-changed.svg" alt="Logo LocalTop"
                class="logo">
        </a>
        <nav class="servicos">
            <a href="pesquisa" class="encontrar">Encontrar <p>LocalTop</p></a>
            <a href="/">Divulgar Serviço</a>
            <a href="/#sobre">Sobre Nós</a>
        </nav>
        <nav class="infos">
            <h3 id="nomeUsu">Nome Usuário </h3>
            <div class="usuario">
                <button class="dropdownUsuario" id="BtnDropdown" onclick="dropdown()">
                    <img src="../imagens/SVGs/perfil.svg" alt="Minha Conta" class="conta">
                </button>
                <div class="dropdown-content">
                    <a href="/perfil">Meu Perfil</a>
                    <button id="logoutBtn">Sair</button>
                </div>
            </div>
        </nav>
    </header>
    <br>
    <div class="container-fluid" style="display: flex; justify-content: center;">
        <img src="../imagens/bannerpesquisa.webp" style="height: 100%; width: 100%;">
    </div>
    <br>
    <br>
    <div style="border: 2px solid re; display: flex; margin-left: 2dvi;">
        <div style="border: 2px solid blu;">
            <h3 style="color: #302163;"> FILTRO DE OPÇÕES </h3>
            <hr>
            <h4 style="color: #3BA06D;"> CATEGORIAS </h4>
            <input type="checkbox"> BELEZA & BEM ESTAR
            <br>
            <input type="checkbox"> PET
            <br>
            <input type="checkbox"> RESIDENCIAL
            <br>
            <input type="checkbox"> LIMPEZA
            <br>
            <input type="checkbox"> TECNOLOGIA
            <hr>
            <H4 style="color: #3BA06D;"> PREÇO </H4>
            <h4> R$ 0 - R$ 10000 </h4>
            <input type="range">
            <hr>
            <h4 style="color: #3BA06D;"> CIDADE </h4>
            <input list="cidades" id="cidades-choice" name="cidades-choice"
                style=" width: 10dvi; height: 1.2dvi; border-radius: 1dvi; border: 2px solid #3BA06D;">

            <datalist id="cidades">
                <option value="Araucaria"></option>
                <option value="Curitiba"></option>
                <option value="Dois Vizinhos"></option>
                <option value="Ponta Grossa"></option>
                <option value="Londrina"></option>
            </datalist>
            <hr>
            <h4 style="color: #3BA06D;"> AVALIAÇÃO </h4>
            <input type="checkbox"> 5 ⭐
            <br>
            <input type="checkbox"> 4 ⭐
            <br>
            <input type="checkbox"> 3 ⭐
            <br>
            <input type="checkbox"> 2 ⭐
            <br>
            <input type="checkbox"> 1 ⭐
        </div>
        <div style="width: 1px; height: 100%dvi; background-color: black; margin-left: 2dvi;">
        </div>
        <div style="display: flex; flex-direction: column; align-items: center; padding-left: 30px; ;"
            class="container-fluid">
            <div style="padding-bottom: 2dvi; ; display: flex; justify-content: space-between; width: 90%;">
                <input type="search" placeholder="Procurando por um estabelecimento especifico?"
                    style="border-radius: 20px; width: 25dvi; height: 1.6dvi; padding-left: 10px;">

                <select name="ordem" id="ordem-choice" name="ordem-choice"
                    style="border-radius: 20px; width: 7dvi; height: 1.6dvi; padding-left: 10px; color: black;">
                    <option value="Ordem"> Ordem</option>
                    <option value="↓ Preço">↓ Preço</option>
                    <option value="↑ Preço">↑ Preço</option>
                    <option value="↓ Avaliação">↓ Avaliação</option>
                    <option value="↑ Avaliação">↑ Avaliação</option>
                </select>

            </div>
            <div class="grade-produtos" id="grade-produtos">
                <!-- <div class="produto">
                    <div class="imagem-container">
                        <img src="../imagens/fachada-do-estabelecimento.jpg" />
                        <button class="favorito">
                            ❤️
                        </button>
                    </div>

                    <h4>
                        Nome Estabelecimento
                        <span class="avaliacao">★ 4.5</span>
                    </h4>

                    <h5>Categorias</h5>
                    <p>Lorem ipsum</p>

                    <h4> Preço: </h3>
                </div>
                <div class="produto">Loja 3</div>
                <div class="produto">Loja 4</div>
                <div class="produto">Loja 5</div>
                <div class="produto">Loja 1</div>
                <div class="produto">Loja 2</div>
                <div class="produto">Loja 1</div>
                <div class="produto">Loja 2</div>
                <div class="produto">Loja 3</div>
                <div class="produto">Loja 4</div>
                <div class="produto">Loja 5</div>
                <div class="produto">Loja 1</div>
                <div class="produto">Loja 2</div>
                <div class="produto">Loja 1</div>
                <div class="produto">Loja 2</div>
                <div class="produto">Loja 3</div>
                <div class="produto">Loja 4</div>
                <div class="produto">Loja 5</div>
                <div class="produto">Loja 1</div>
                <div class="produto">Loja 2</div>
                <div class="produto">Loja 1</div>
                <div class="produto">Loja 2</div>
                <div class="produto">Loja 3</div>
                <div class="produto">Loja 4</div>
                <div class="produto">Loja 5</div>
                <div class="produto">Loja 1</div>
                <div class="produto">Loja 2</div>
                <div class="produto">Loja 1</div>
                <div class="produto">Loja 2</div>
                <div class="produto">Loja 3</div>
                <div class="produto">Loja 4</div>
                <div class="produto">Loja 5</div>
                <div class="produto">Loja 1</div>
                <div class="produto">Loja 2</div>
                <div class="produto">Loja 1</div>
                <div class="produto">Loja 2</div>
                <div class="produto">Loja 3</div>
                <div class="produto">Loja 4</div>
                <div class="produto">Loja 5</div>
                <div class="produto">Loja 1</div>
                <div class="produto">Loja 2</div> -->
                <!-- ...e assim por diante -->
            </div>
        </div>
    </div>

    </div>

    <script>
        async function listarEstabelecimentos() {
            try {
                const resp = await fetch('/api/estabelecimentos-completos');
                if (!resp.ok) {throw new Error(`Status ${resp.status}`);return };
                const estabelecimentos = await resp.json();
                console.log('JSON da API →', estabelecimentos);

                if (!Array.isArray(estabelecimentos)) {
                    console.error('Esperava um array, recebi:', estabelecimentos);
                    return;
                }

                const grade = document.getElementById('grade-produtos');
                grade.innerHTML = '';

                estabelecimentos.forEach(estab => {
                    const nome = estab.Nome || '—';
                    const media = estab.Ofertas[0].Avaliacaos[0].Nota || 'Sem avaliações';
                    const foto = estab.fotoSrc || 'imagens/placeholder.png';

                    // Pega a primeira oferta, se existir
                    const oferta = (estab.Ofertas && estab.Ofertas[0]) || {};
                    const servico = oferta.servicoNome || '—';
                    const desc = oferta.Descricao || 'Sem descrição';
                    const valor = oferta.Valor != null
                        ? `R$ ${oferta.Valor.toFixed(2)}`
                        : 'Preço indisponível';

                    const card = document.createElement('div');
                    card.className = 'produto';

                    card.innerHTML = `
        <div class="imagem-container">
          <img src="${foto}" alt="Foto de ${nome}" />
          <button class="favorito">❤️</button>
        </div>
        <h4>${nome} <span class="avaliacao">★ ${media}</span></h4>
        <h5>${servico}</h5>
        <p>${desc}</p>
        <h4>Preço: ${valor}</h4>
      `;
                    grade.appendChild(card);
                });
            } catch (err) {
                console.error('Erro ao chamar /api/estabelecimentos-completos:', err);
            }
        }

        document.addEventListener('DOMContentLoaded', listarEstabelecimentos);

        function dropdown() {
            const dropdown = document.querySelector(`.dropdown-content`);
            dropdown.style.display === "flex" ? dropdown.style.display = "none" : dropdown.style.display = "flex";
        };
    </script>
</body>

</html>